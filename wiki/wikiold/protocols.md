# Protocols
## y3ip
- signature: 4 bytes = "y3ip"
- version: 1 byte uint
- header_ln: 2 bytes uint
- header
    - id: 4 bytes uint
    - hop_param: 1 byte bitarray
        - min_delay: 1 bit
        - max_bandwidth: 1 bit
        - max_safety: 1 bit
        - priority: 3 bits uint
        - dont_fragment: 1 bit
        - more_fragments: 1 bit
    - fragment_offset: 2 bytes uint
    - ttl: 2 byte uint
    - nt: 1 byte uint
    - src_ln: 1 byte uint
    - src_addr: 2*src_ln bytes
    - dst_ln: 1 byte uint
    - dst_addr: 2*dst_ln bytes
    - data_ln: 2 bytes uint
- header_crc: 4 bytes uint
- data: data_ln bytes
- data_crc: 4 bytes uint

### Внутренние и внешние адреса

#### Внешние адреса
- 0.A[n] - локальный адрес
- A[1] - корневая мэш-сеть 
- 65534.A[128].x[n] - маршрутизация с использованием публичного ключа A(256 bytes) до ноды x[n] в этой сети
- 65535 - loopback на самого себя, переадресация на 65535.0.0
- 65535.0.0 - loopback на свой роутер
- 65535.0.1 - указатель на мастер-ноду в первой сети роутера
- 65535.1.1 - указатель на мастер-ноду во второй сети роутера
- 65535.1.0 - loopback на свой роутер во второй сети роутера (по сути равен и переадресует на 65535.0.0)
- 65535.0.x[n] - loopback на узел x[n] в первой сети роутера

#### Внутренние адреса
- 0.0 - указатель на роутер
- 1.0 - указатель на роутер из второй сети (равен и переадресуется на 0.0)
- 0.1 - указатель на мастера в первой сети
- 1.1 - указатель на мастера во второй сети (second net)
- 65534.1 - указатель на 1 родителя роутера
- 65534.0 - указатель на роутер
- 65535.3 - указатель на 3 ребенка роутера
- 65535.0 - указатель на роутер

##### Нельзя использовать адреса с длиной отличной от 2
- 1.3.2 - не указывет на 2 ребенка 3 соседа, вызывает ошибку
- 1 - просто внутренний номер сети, не является указателем ни на что (только как инфо для отладки), вызывает ошибку


## y4sm
- signature: 4 bytes = "y4sm"
- src_port: 2 bytes uint
- dst_port: 2 bytes uint
- data_ln: 2 bytes uint
- data: data_ln bytes
- package_crc: 4 bytes uint

## y3cm TODO
- signature: 4 bytes = "y3sm"
- version: 1 byte uint
- header_ln: 2 bytes uint
- type: 1 byte uint
- subtype: 1 byte uint
- package_id: 4 bytes uint
- dst_ln: 1 byte uint
- dst_addr: 2*dst_ln bytes
- data_ln: 1 byte uint
- data: data_ln bytes

### Тип 0 - Эхо сообщения
- 0.0 - Эхо запрос
    - data:
        - traceroute: отправлять icmp пакеты обратно с каждого узла с timestamp
- 0.1 - Эхо ответ
    - Запрос traceroute - ответ data:
        - timestamp=<...> // src_addr берется из пакета
### Тип 1 - Недоступность сети
- 1.0 - Сеть недоступна (нет маршрута)
- 1.1 - Не используется
- 1.2 - Протокол недостижим
- 1.3 - Порт недостижим
- 1.4 - Необходима фрагментация, но она запрещена
- 1.5 - Сеть назначения недостижима (сеть в который пришло сообщение не имеет маршрута к сети)
- 1.6 - Узел назначения недостижим (сообщение дошло до конечной сети, но в ней нет такого узла)
### Тип 2 - Перенаправления
- 2.0 - Перенаправить в сеть 
- 2.1 - Перенаправит в узел
- 2.2 - Перенаправить пакет для типа обслуживания/приоритета
### Тип 3 - Время жизни
- 3.0 - TTL истек
- 3.1 - NT истек
### Тип 4 - Ошибка в пакете
- 4.0 - Ошибка в заголовке
- 4.1 - Ошибка в пакете
### Тип 255 - Пользовательские сообщение
- 255.0 - Запрос. 2 байта id, 256 байт текста
- 255.1 - Ответ. 2 байта id, 256 байт текста

## [y4sl](/wiki/extentions/federative-cartographer.md) - протокол общения между leek сетями
## [y7mm](/wiki/extentions/master.md) - протокол взаимодействия с мастером
## [y7lm](/wiki/extentions/leek-master.md) - протокол взаимодействия с leek мастером
